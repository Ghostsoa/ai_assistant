# 会话管理命令

## 📋 命令列表

### 基础命令

| 命令 | 说明 | 示例 |
|------|------|------|
| `/new [标题]` | 创建新会话 | `/new 代码重构项目` |
| `/list` | 列出所有会话 | `/list` |
| `/switch <ID\|序号>` | 切换会话 | `/switch 1` 或 `/switch 20231202_150405` |
| `/clear` | 清空当前会话 | `/clear` |
| `/delete <ID\|序号>` | 删除会话 | `/delete 2` |
| `/rename <ID\|序号> <新标题>` | 重命名会话 | `/rename 1 Bug修复` |
| `/help` | 显示帮助 | `/help` |
| `/exit`, `/quit`, `/q` | 退出程序 | `/exit` |

### 不带 `/` 的退出命令
```
quit
exit  
q
```

## 🗂️ 会话管理

### 会话ID格式
每个会话都有唯一的ID，格式为：`YYYYMMDD_HHMMSS`
例如：`20231202_150405`

### 会话存储位置

**Windows:**
```
C:\Users\<用户名>\AppData\Roaming\jarvis\sessions\
├── index.json              # 会话索引
├── 20231202_150405.json   # 会话1的历史记录
├── 20231202_151030.json   # 会话2的历史记录
└── ...
```

**Linux/Mac:**
```
~/.config/jarvis/sessions/
├── index.json              # 会话索引
├── 20231202_150405.json   # 会话1的历史记录
└── ...
```

## 💡 使用示例

### 示例 1：创建和切换会话

```
▶ USER >> /new 代码审查任务

[✓] 已创建新会话: 代码审查任务 [20231202_150405]

▶ USER >> 帮我审查这段代码...

... (对话中) ...

▶ USER >> /new Bug修复记录

[✓] 已创建新会话: Bug修复记录 [20231202_151530]

▶ USER >> /list

[信息] 所有会话：

◆ [1] Bug修复记录
    ID: 20231202_151530
    创建: 2023-12-02 15:15:30
    更新: 2023-12-02 15:15:30

  [2] 代码审查任务
    ID: 20231202_150405
    创建: 2023-12-02 15:04:05
    更新: 2023-12-02 15:10:20

▶ USER >> /switch 2

[✓] 已切换到会话: 代码审查任务 [20231202_150405]

[会话] 代码审查任务 [20231202_150405]
[信息] ✓ 已加载 15 条历史消息
```

### 示例 2：清空和删除会话

```
▶ USER >> /clear

[✓] 当前会话已清空

▶ USER >> /list

[信息] 所有会话：

◆ [1] Bug修复记录
    ID: 20231202_151530
    ...

  [2] 代码审查任务
    ID: 20231202_150405
    ...

▶ USER >> /delete 2

[✓] 已删除会话: 20231202_150405
```

### 示例 3：重命名会话

```
▶ USER >> /list

[信息] 所有会话：

◆ [1] 新对话
    ID: 20231202_160000
    ...

▶ USER >> /rename 1 性能优化讨论

[✓] 已重命名会话: 性能优化讨论
```

## 🎯 使用场景

### 1. 按项目分组
```
/new 项目A - 前端开发
/new 项目A - 后端API
/new 项目B - 数据库设计
```

### 2. 按任务类型分组
```
/new 代码审查
/new Bug修复
/new 新功能开发
/new 文档编写
```

### 3. 按时间分组
```
/new 2023-12-01 工作记录
/new 2023-12-02 工作记录
```

## ⚙️ 会话数据结构

**index.json** (会话索引)
```json
[
  {
    "id": "20231202_150405",
    "title": "代码审查任务",
    "created_at": "2023-12-02T15:04:05+08:00",
    "updated_at": "2023-12-02T15:10:20+08:00",
    "file_path": "C:\\Users\\...\\jarvis\\sessions\\20231202_150405.json"
  }
]
```

**会话历史文件** (例如：20231202_150405.json)
```json
[
  {
    "role": "system",
    "content": "系统提示词..."
  },
  {
    "role": "user",
    "content": "用户消息"
  },
  {
    "role": "assistant",
    "content": "AI回复",
    "reasoning_content": "思维链内容"
  }
]
```

## 🔒 会话安全

1. **本地存储**：所有会话数据存储在本地用户目录
2. **不会上传**：会话数据不会被推送到 GitHub（已在 `.gitignore` 中排除）
3. **独立管理**：每个会话独立保存，互不影响
4. **自动更新**：会话时间戳会在每次对话后自动更新

## 📝 注意事项

1. **序号变化**：删除会话后，序号会重新排列
2. **当前会话标记**：列表中用 `◆` 标记当前活动会话
3. **自动创建**：首次运行会自动创建"默认对话"会话
4. **删除保护**：删除当前会话时，会自动切换到其他会话或创建新会话
5. **历史保留**：清空会话只清空聊天记录，不删除会话本身

## 🚀 快捷操作

```bash
# 快速创建会话并开始对话
/new 我的任务

# 查看所有会话
/list

# 快速切换到第一个会话
/switch 1

# 清空当前会话重新开始
/clear

# 退出（支持多种方式）
quit
exit
q
/exit
/quit
/q
```

---

**J.A.R.V.I.S** - 智能会话管理，让对话井井有条！
